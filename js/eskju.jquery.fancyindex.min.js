
jQuery.fn.FancyIndex=function(a){new FancyIndex(this,a)};FancyIndex=function(a,b){this.init(a,b)};jQuery.extend(FancyIndex.prototype,{init:function(a,b){this.selector=jQuery(a);this.items=[];this.disabled=false;this.lastActivity=0;this.options=jQuery.extend({hideWhenInactive:true,focusInitally:true,focusOnResize:true,focusOnScroll:true,focusOnHover:true,focusTimeout:1000,firstOnly:false,forceLastActive:true,scrollToDuration:1000,scrollOnClick:true,maxPrioritizedItems:3},b);this.loadHierarchy();this.bindSelf();this.bindScroll();this.bindResize();this.bindHover();this.updateItems();if(this.options.hideWhenInactive){if(this.options.focusInitally){this.setActive()}else{this.hide()}}},setActive:function(){var a=this;jQuery("#esKju-fancyIndex").removeClass("inactive");jQuery("#esKju-fancyIndex").animate({minHeight:0},parseInt(this.options.focusTimeout),function(){a.hide()})},hide:function(){if(this.options.hideWhenInactive){jQuery("#esKju-fancyIndex").addClass("inactive")}},bindSelf:function(){var a=this;jQuery("body").bind("refreshFancyIndex",function(c,b){a.options=b})},bindScroll:function(){var a=this;jQuery(window).scroll(function(){a.updateItems();if(a.options.focusOnScroll){a.setActive()}})},bindResize:function(){var a=this;jQuery(window).resize(function(){a.updateItems();if(a.options.focusOnResize){a.setActive()}})},bindHover:function(){var a=this;jQuery("#esKju-fancyIndex").hover(function(){if(a.options.focusOnHover){a.setActive()}})},updateItems:function(){var e=this;var d=jQuery(window).scrollTop();var f=jQuery(window).height();var b=false;var c=parseInt(this.options.maxPrioritizedItems);var a=false;jQuery.each(e.items,function(g,h){jQuery(h.obj).removeClass("active");jQuery(h.obj).removeClass("prioritized");for(i=1;i<=parseInt(e.options.maxPrioritizedItems);i++){jQuery(h.obj).removeClass("priority-"+i)}if(d>parseInt(h.offset.top)+50){a=jQuery(h.obj)}if((d<=parseInt(h.offset.top)+50&&d+f>=parseInt(h.offset.top)&&(!e.options.firstOnly||!b))&&(parseInt(e.options.maxPrioritizedItems)==0||c>0)){jQuery(h.obj).addClass("active");jQuery(h.obj).addClass("prioritized");jQuery(h.obj).addClass("priority-"+c);b=true;c--}});if(e.options.forceLastActive&&jQuery("#esKju-fancyIndex .active").length==0){jQuery(a).addClass("active");jQuery(a).addClass("prioritized");jQuery(a).addClass("priority-"+e.options.maxPrioritizedItems)}},loadHierarchy:function(){var a=this;this.items=[];esKjuFancyIndex=jQuery("<ul>").attr("id","esKju-fancyIndex");jQuery("body").append(esKjuFancyIndex);jQuery(this.selector.find("h1,h2,h3,h4,h5,h6,h7")).each(function(c,f){var b=jQuery(f).prop("tagName").toLowerCase();var e=jQuery(f).html();var g=jQuery(f).offset();var d=jQuery("<li>").addClass(b).html("<div>"+e+"</div>");esKjuFancyIndex.append(d);a.items.push({offset:g,obj:d});if(a.options.scrollOnClick){jQuery(d).find("div").click(function(){g=jQuery(f).offset();jQuery("html, body").animate({scrollTop:g.top},parseInt(a.options.scrollToDuration))})}})}});